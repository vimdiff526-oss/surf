<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>SloSea Slot｜波運スロット</title>
<meta name="description" content="3リールのスロットで今日の波運を占おう。絵柄はフルーツ＋大当たりキャラ。結果と一緒にサーフィン用語の解説も表示されます。" />
<style>
  :root{
    --bg:#f7fbff;
    --card:#ffffff;
    --ink:#0f172a;
    --muted:#475569;
    --line:#e2e8f0;
    --brand:#0ea5e9;
    --accent:#22d3ee;
    --good:#10b981;
    --warn:#f59e0b;
    --bad:#ef4444;
  }
  *{box-sizing:border-box}
  html,body{margin:0}
  body{
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Noto Sans JP","Hiragino Kaku Gothic ProN","Yu Gothic UI",sans-serif;
    line-height:1.6;color:var(--ink);background:
      radial-gradient(120% 100% at 50% 0%, #e6f8ff 0%, #f7fbff 55%) no-repeat,
      var(--bg);
    min-height:100svh;
  }
  .wrap{max-width:980px;margin:0 auto;padding:20px 16px 40px}
  header{display:flex;align-items:center;justify-content:space-between;margin:8px 0 16px}
  header h1{font-size:clamp(22px,4vw,32px);margin:0}
  header small{color:var(--muted)}

  .game{
    background:var(--card); border:1px solid var(--line); border-radius:18px;
    box-shadow:0 12px 30px rgba(15,23,42,.07); padding:18px;
  }
  .reels{
    display:grid; grid-template-columns:repeat(3,1fr); gap:14px; margin-top:10px;
  }
  .reel{
    background:linear-gradient(180deg,#f8feff,#fff); border:1px solid var(--line);
    border-radius:16px; padding:12px; display:flex; align-items:center; justify-content:center;
    height:150px; position:relative; overflow:hidden;
  }
  .cell{
    width:120px; height:120px; border-radius:12px; border:1px solid #dbeafe;
    display:flex; align-items:center; justify-content:center;
    font-size:64px; background:#fff;
    box-shadow:inset 0 0 0 1px rgba(14,165,233,.12);
  }
  /* 大当たりキャラ（game.png） */
  .cell img.char{
    width:100%; height:100%; object-fit:cover; object-position:center;
    display:block; border-radius:10px;
  }

  .controls{
    display:grid; grid-template-columns:1fr 1fr 1fr 1fr; gap:12px; margin:16px 0 4px;
  }
  .btn{
    appearance:none; border:none; border-radius:12px; padding:12px 14px;
    font-weight:800; letter-spacing:.2px; cursor:pointer;
    color:#003; background:linear-gradient(135deg,var(--brand),var(--accent));
    box-shadow:0 10px 22px rgba(14,165,233,.25);
  }
  .btn:disabled{opacity:.5; cursor:not-allowed; box-shadow:none}
  .btn--stop{background:#0f172a; color:#fff}
  .btn--ghost{background:#fff; color:var(--ink); border:1px solid var(--line); box-shadow:none}

  .meter{
    height:12px; background:#eef2ff; border-radius:999px; overflow:hidden; margin:10px 0 0;
    border:1px solid var(--line)
  }
  .meter>i{
    display:block; height:100%; width:0%;
    background:linear-gradient(90deg,#60a5fa,#22d3ee,#34d399);
    transition:width .5s ease;
  }

  .result{
    margin-top:14px; display:grid; grid-template-columns:1.2fr .8fr; gap:14px;
  }
  .panel{
    border:1px solid var(--line); border-radius:14px; padding:12px; background:#fff;
  }
  .result h2{font-size:clamp(18px,2.8vw,22px); margin:0 0 6px}
  .luck{font-size:clamp(18px,3.5vw,26px); font-weight:900}
  .luck.good{color:var(--good)} .luck.ok{color:#0284c7} .luck.warn{color:var(--warn)} .luck.bad{color:var(--bad)}
  .term dt{font-weight:900} .term dd{margin:0;color:var(--muted)}
  .note{color:var(--muted); font-size:13px}

  @media (max-width:760px){
    .reel{height:130px}
    .cell{width:100px;height:100px;font-size:56px}
    .controls{grid-template-columns:1fr 1fr; grid-auto-rows:1fr}
    .result{grid-template-columns:1fr}
  }
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>波運スロット <small>— SloSea</small></h1>
      <small class="note">※遊び用の占いです。ギャンブル要素はありません。</small>
    </header>

    <section class="game" aria-label="スロットゲーム">
      <!-- リール -->
      <div class="reels">
        <div class="reel" id="reel0" aria-live="polite"><div class="cell">🍉</div></div>
        <div class="reel" id="reel1" aria-live="polite"><div class="cell">🍋</div></div>
        <div class="reel" id="reel2" aria-live="polite"><div class="cell">🍇</div></div>
      </div>

      <!-- 操作 -->
      <div class="controls">
        <button id="btnStart" class="btn" type="button">SPIN</button>
        <button id="btnStop0" class="btn btn--stop" type="button" disabled>STOP 1</button>
        <button id="btnStop1" class="btn btn--stop" type="button" disabled>STOP 2</button>
        <button id="btnStop2" class="btn btn--stop" type="button" disabled>STOP 3</button>
      </div>

      <!-- 波運メーター -->
      <div class="meter" aria-hidden="true"><i id="meterBar"></i></div>

      <!-- 結果 -->
      <div class="result">
        <div class="panel">
          <h2>今日の波運</h2>
          <div id="luckText" class="luck ok">—</div>
          <p id="desc" class="muted" style="margin:.4rem 0 0;color:var(--muted)">SPIN を押して占い開始！</p>
        </div>
        <div class="panel">
          <h2>サーフ用語</h2>
          <dl class="term">
            <dt id="termWord">—</dt>
            <dd id="termDesc">結果確定後に用語が表示されます。</dd>
          </dl>
          <div style="display:flex;gap:8px;margin-top:8px">
            <button id="btnAgain" class="btn btn--ghost" type="button" disabled>もう一度</button>
            <button id="btnShuffleTerm" class="btn btn--ghost" type="button" disabled>用語だけシャッフル</button>
          </div>
        </div>
      </div>
    </section>

    <p class="note" style="margin-top:12px">キャラ画像：<code>game.png</code> をこのHTMLと同じフォルダへ配置してください（サムネを自動トリミングして表示）。</p>
  </div>

<script>
/* =========================
   リール・シンボル定義
   ========================= */
const SPECIAL_CHAR = { id: 'char', type:'img', src: './game.png', label: 'CHAR' }; // 大当たりキャラ
const FRUITS = [
  { id:'cherry', label:'🍒' }, { id:'lemon', label:'🍋' }, { id:'banana', label:'🍌' },
  { id:'grape', label:'🍇' }, { id:'peach', label:'🍑' }, { id:'pine', label:'🍍' },
  { id:'melon', label:'🍈' }, { id:'straw', label:'🍓' }, { id:'water', label:'🍉' }
];

// 重み（キャラは出にくい）
const WEIGHTED_POOL = [
  ...FRUITS.flatMap(sym => Array(8).fill(sym)), // 各フルーツ×8
  ...Array(2).fill(SPECIAL_CHAR)               // キャラ×2
];

function pickSymbol(){
  const i = Math.floor(Math.random()*WEIGHTED_POOL.length);
  return WEIGHTED_POOL[i];
}
function renderCell(sym){
  const cell = document.createElement('div');
  cell.className = 'cell';
  if(sym.type === 'img'){
    const img = document.createElement('img');
    img.src = sym.src; img.alt = '大当たりキャラ'; img.className = 'char';
    cell.appendChild(img);
  }else{
    cell.textContent = sym.label;
  }
  cell.dataset.id = sym.id;
  return cell;
}

/* =========================
   スロット状態管理
   ========================= */
const reels = [0,1,2].map(i=>({
  el: document.getElementById('reel'+i),
  timer: null,
  spinning: false,
  finalSymbol: null
}));

const btnStart = document.getElementById('btnStart');
const btnStops = [0,1,2].map(i=>document.getElementById('btnStop'+i));
const meterBar = document.getElementById('meterBar');
const luckText = document.getElementById('luckText');
const desc = document.getElementById('desc');
const btnAgain = document.getElementById('btnAgain');
const btnShuffleTerm = document.getElementById('btnShuffleTerm');

btnStart.addEventListener('click', startSpin);
btnStops.forEach((b,i)=>b.addEventListener('click', ()=>stopReel(i)));
btnAgain.addEventListener('click', resetAndSpin);
btnShuffleTerm.addEventListener('click', showRandomTerm);

/* =========================
   操作
   ========================= */
function startSpin(){
  clearAll();
  btnStart.disabled = true;
  btnAgain.disabled = true;
  btnShuffleTerm.disabled = true;
  btnStops.forEach(b=>b.disabled=false);
  luckText.textContent = 'スピン中…';
  luckText.className = 'luck ok';
  desc.textContent = '止めたいリールの STOP を押してください。';

  reels.forEach((r,idx)=>{
    r.spinning = true;
    r.timer = setInterval(()=>{
      const sym = pickSymbol();
      r.el.replaceChildren(renderCell(sym));
    }, 90 + idx*15); // 少しだけ速度差
  });
}

function stopReel(index){
  const r = reels[index];
  if(!r.spinning) return;
  clearInterval(r.timer);
  r.spinning = false;
  r.finalSymbol = pickSymbol(); // 最終出目を抽選
  r.el.replaceChildren(renderCell(r.finalSymbol));
  btnStops[index].disabled = true;

  // すべて停止したら判定
  if(reels.every(x=>!x.spinning)){
    evaluate();
    btnAgain.disabled = false;
    btnShuffleTerm.disabled = false;
    btnStart.disabled = false;
  }
}

function resetAndSpin(){
  resetUI();
  startSpin();
}

function clearAll(){
  reels.forEach(r=>{
    if(r.timer) clearInterval(r.timer);
    r.spinning = false; r.timer = null; r.finalSymbol = null;
  });
}

function resetUI(){
  meterBar.style.width = '0%';
  luckText.textContent = '—';
  luckText.className = 'luck ok';
  desc.textContent = 'SPIN を押して占い開始！';
  document.getElementById('termWord').textContent = '—';
  document.getElementById('termDesc').textContent = '結果確定後に用語が表示されます。';
}

/* =========================
   判定ロジック
   ========================= */
function evaluate(){
  const ids = reels.map(r=>r.finalSymbol?.id || '');  // ['banana','char','grape'...]
  const counts = ids.reduce((m,id)=> (m[id]=(m[id]||0)+1, m), {});
  const hasChar = ids.includes('char');

  let score = 40; // 初期値（0〜100）
  let message = '普通：無理なく練習日和。';
  let level = 'ok';

  const uniq = Object.keys(counts).length;

  // 3つ同じ
  if(uniq===1){
    if(hasChar){ // キャラ×3
      score = 100; message = '大当たり！爆発的：ダブルオーバーヘッド級!? 最高の一本を。';
      level = 'good'; confetti();
    }else{
      score = 85; message = '絶好調：セットの良い波が安定して入りそう。';
      level = 'good';
    }
  }
  // 2つ同じ + 1つ違う（キャラはワイルド扱い）
  else if(uniq===2){
    const pairId = Object.entries(counts).find(([id,c])=>c===2)?.[0];
    const hasPair = !!pairId && pairId!=='char';
    if(hasChar && hasPair){
      score = 78; message = 'かなり良い：風と潮を合わせて狙い撃ち。';
      level = 'good';
    }else if(hasPair){
      score = 62; message = 'まずまず：混雑を避ければ良い練習ができそう。';
      level = 'ok';
    }else{
      score = 55; message = '可もなく不可もなく：潮回り次第。';
      level = 'ok';
    }
  }
  // すべて異なる
  else{
    if(hasChar){
      score = 58; message = 'チャンス有り：タイミング次第で当てられるかも。';
      level = 'ok';
    }else{
      score = 30; message = 'イマイチ：無理せず陸トレや情報収集も。';
      level = 'warn';
    }
  }

  meterBar.style.width = Math.min(score,100)+'%';
  luckText.textContent = message;
  luckText.className = 'luck ' + (level==='good'?'good':level==='warn'?'warn':level==='bad'?'bad':'ok');
  desc.textContent = `出目：${ids.map(idToEmoji).join(' | ')}`;
  showRandomTerm();
}

function idToEmoji(id){
  if(id==='char') return '🎯大当たりキャラ';
  const f = FRUITS.find(x=>x.id===id);
  return f ? f.label : '？';
}

/* =========================
   用語データ
   ========================= */
const TERMS = [
  ['オフショア','海から陸へ向かう風。面が整いやすく、良いブレイクを生みやすい。'],
  ['オンショア','陸から海へ向かう風。面が荒れ、トロい割れ方になりやすい。'],
  ['セット','周期的に入るサイズの大きな波のまとまり。次のセット間隔も意識。'],
  ['ピーク','波が最初に立ち上がり割れ始める頂点。最もパワーがある場所。'],
  ['ショルダー','ピークから横に伸びる乗りしろ。走るラインをイメージする部分。'],
  ['インサイド','岸に近い浅いエリア。スープが多くパドルの戻りが重くなる。'],
  ['アウト','沖のラインナップ。波待ち・テイクオフの基点になる場所。'],
  ['ダックダイブ','沈めて波の下をくぐるテクニック。ショート向け。'],
  ['テイクオフ','波に押されて立ち上がる動作。初級者の最重要基礎。'],
  ['ボトムターン','立ち上がった後の最初の大きなターン。全ての技の起点。'],
  ['カットバック','走りすぎた後にブレイクへ戻るターン。スピードコントロール。'],
  ['リップ','波の崩れる上部。アクションを仕掛ける的になる。'],
  ['クローズアウト','一気に岸まで同時に割れる状態。走る余地が少ない。'],
  ['ダンパー','力強く急に潰れるような波質。刺さりやすく要注意。'],
  ['レギュラー/グーフィー','右足/左足が後ろのスタンス。自分の向きを把握しよう。'],
  ['ショアブレイク','岸近くで急に掘れて割れる波。サイズの割に危険度高め。'],
  ['クロスショア','横から吹く風。面がバラけやすいがポジション次第で◎。'],
  ['フェイス','波の滑走面。綺麗なフェイス＝乗りやすい波のサイン。']
];

function showRandomTerm(){
  const [w,d] = TERMS[Math.floor(Math.random()*TERMS.length)];
  document.getElementById('termWord').textContent = w;
  document.getElementById('termDesc').textContent = d;
}

/* =========================
   演出：かんたん紙吹雪
   ========================= */
function confetti(){
  const n=24, root=document.body;
  for(let i=0;i<n;i++){
    const s=document.createElement('div');
    const size=8+Math.random()*8;
    s.style.position='fixed';
    s.style.left=Math.random()*100+'vw';
    s.style.top='-10px';
    s.style.width=size+'px';
    s.style.height=size+'px';
    s.style.background=`hsl(${Math.floor(Math.random()*360)} 85% 60%)`;
    s.style.borderRadius='2px';
    s.style.opacity='0.9';
    s.style.zIndex='9999';
    s.style.transform=`rotate(${Math.random()*360}deg)`;
    s.style.transition='transform 1.2s linear, top 1.2s linear, opacity .3s ease 1.1s';
    root.appendChild(s);
    requestAnimationFrame(()=>{
      s.style.top='110vh';
      s.style.transform+=` translateY(100vh) rotate(${720+Math.random()*360}deg)`;
      s.addEventListener('transitionend',()=>s.remove(),{once:true});
      setTimeout(()=>s.style.opacity='0',1100);
    });
  }
}

// 初期表示の絵柄をきれいに
reels.forEach((r,i)=>{
  r.el.replaceChildren(renderCell(pickSymbol()));
});

</script>
</body>
</html>
