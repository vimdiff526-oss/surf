<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>è¶…ã‚†ã‚‹æ¥½å¤©ãƒ†ã‚¹ãƒˆ | SEA LIFE HUB</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="è¶…ã‚†ã‚‹æ¤œç´¢ã§ã¾ãšã¯è¡¨ç¤ºã•ã‚Œã‚‹ã“ã¨ã‚’ç¢ºèªã™ã‚‹ãƒ†ã‚¹ãƒˆãƒšãƒ¼ã‚¸" />
  <link rel="stylesheet" href="style.css" />
  <style>
    .wrap{max-width:980px;margin:24px auto;padding:0 16px;}
    .row{display:flex;gap:8px;flex-wrap:wrap;align-items:center;margin:8px 0 16px;}
    input,button{padding:10px;border-radius:8px;border:none}
    button{background:rgba(255,255,255,0.15);cursor:pointer}
    button:hover{background:rgba(255,255,255,0.25)}
    .items-grid{display:grid;gap:12px;grid-template-columns:repeat(3,1fr)}
    @media (max-width:960px){.items-grid{grid-template-columns:repeat(2,1fr)}}
    @media (max-width:640px){.items-grid{grid-template-columns:1fr}}
    .card img{height:200px;object-fit:cover}
    .skeleton{background:linear-gradient(90deg,rgba(255,255,255,.08),rgba(255,255,255,.18),rgba(255,255,255,.08));background-size:200% 100%;animation:shine 1.2s linear infinite;height:200px;border-radius:12px}
    @keyframes shine{0%{background-position:200% 0}100%{background-position:-200% 0}}
    .mini{opacity:.85}
  </style>
</head>
<body>
  <header class="site-header">
    <a href="index.html" class="logo">ğŸŒŠ SEA LIFE HUB</a>
  </header>
  <div class="header-spacer"></div>

  <main class="wrap">
    <h1 class="section-title">æ¥½å¤© è¶…ã‚†ã‚‹è¡¨ç¤ºãƒ†ã‚¹ãƒˆ</h1>
    <p class="mini">â€»ã¨ã‚Šã‚ãˆãšã‚¢ã‚¤ãƒ†ãƒ ãŒå‡ºã‚‹ã“ã¨ã®ç¢ºèªç”¨ã€‚å£²åˆ‡ã‚„ç”»åƒãªã—ã‚‚å«ã‚ã¦åºƒãæ‹¾ã„ã¾ã™ã€‚</p>

    <div class="row">
      <input id="kw" type="text" placeholder="ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ï¼ˆç©ºã§ã‚‚OKï¼‰ ä¾‹ï¼šã‚µãƒ¼ãƒ•ãƒœãƒ¼ãƒ‰ ãƒ„ã‚¤ãƒ³" style="min-width:260px;flex:1" />
      <input id="min" type="number" placeholder="æœ€å°ä¾¡æ ¼" min="0" step="1000" style="width:120px" />
      <input id="max" type="number" placeholder="æœ€å¤§ä¾¡æ ¼" min="0" step="1000" style="width:120px" />
      <button id="go">è¶…ã‚†ã‚‹æ¤œç´¢</button>
    </div>

    <div id="info" class="mini"></div>
    <div id="grid" class="items-grid" style="margin-top:12px"></div>
  </main>

  <script>
    const API = `${location.origin}/api/rakuten_loose`;

    function placeholder(img){
      return img || 'images/diagnosis.jpg';
    }

    function skeletons(n=6){
      return Array.from({length:n}).map(()=>'<div class="skeleton"></div>').join('');
    }

    async function search(){
      const kw = document.getElementById('kw').value.trim();
      const min = document.getElementById('min').value.trim();
      const max = document.getElementById('max').value.trim();
      const grid = document.getElementById('grid');
      const info = document.getElementById('info');
      grid.innerHTML = skeletons(6);
      info.textContent = 'æ¤œç´¢ä¸­â€¦';

      const sp = new URLSearchParams();
      if(kw) sp.set('keyword', kw);
      if(min) sp.set('minPrice', String(min));
      if(max) sp.set('maxPrice', String(max));

      try{
        const r = await fetch(`${API}?${sp.toString()}`);
        const ct = r.headers.get('content-type') || '';
        if(!ct.includes('application/json')) throw new Error(`éJSONå¿œç­”: ${r.status} ${r.statusText} / ${ct}`);
        const data = await r.json();
        info.innerHTML = `ä½¿ç”¨ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ï¼š<code>${data.usedKeyword || kw || '(ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ)'}</code> ï¼ ä»¶æ•°ï¼š<strong>${data.count}</strong>`;
        if(!data.items || !data.items.length){
          grid.innerHTML = '<p class="mini">0ä»¶ã§ã—ãŸã€‚ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’ã‚‚ã£ã¨åºƒãã™ã‚‹ã‹ã€ä¾¡æ ¼æŒ‡å®šã‚’å¤–ã—ã¦ãŠè©¦ã—ãã ã•ã„ã€‚</p>';
          return;
        }
        grid.innerHTML = data.items.map(x => `
          <article class="card">
            <img src="${placeholder(x.image)}" alt="${x.name}">
            <div class="card-body">
              <h3 style="font-size:1rem;margin:0 0 6px">${x.name}</h3>
              <p class="mini">${x.shop || ''}</p>
              <p><strong>Â¥${Number(x.price).toLocaleString()}</strong></p>
              <a class="btn link" target="_blank" href="${x.url}">å•†å“ãƒšãƒ¼ã‚¸ã¸</a>
            </div>
          </article>
        `).join('');
      }catch(e){
        info.textContent = `ã‚¨ãƒ©ãƒ¼: ${String(e)}`;
        grid.innerHTML = '';
      }
    }

    document.getElementById('go').addEventListener('click', search);

    // ãƒšãƒ¼ã‚¸è¡¨ç¤ºæ™‚ã«ä¸€å›ã€ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ç©ºã§å®Ÿè¡Œï¼ˆæœ€ã‚‚åºƒã„æ¤œç´¢ï¼‰
    window.addEventListener('load', search);
  </script>
</body>
</html>
