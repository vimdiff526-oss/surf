<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>ã‚µãƒ¼ãƒ•ãƒœãƒ¼ãƒ‰è¨ºæ–­ | SEA LIFE HUB</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="æ¨å¥¨ã‚µã‚¤ã‚ºã‚’è¨ˆç®—ã—ã€ECã‚’â€œã‚µãƒ¼ãƒ•ãƒœãƒ¼ãƒ‰é™å®šâ€ã§æ¤œç´¢ã€‚0ä»¶ã‚’é¿ã‘ã‚‹ãŸã‚ã«ã€å³å¯†/æ¨™æº–/ã‚†ã‚‹ã‚ã®æ›–æ˜§æ¤œç´¢ãƒªãƒ³ã‚¯ã‚’è‡ªå‹•ç”Ÿæˆã—ã¾ã™ã€‚" />
  <link rel="stylesheet" href="style.css" />
  <style>
    form#surfForm{
      display:grid; gap:12px; max-width:860px; margin:16px auto 0; grid-template-columns:1fr 1fr;
      background: rgba(0,0,0,0.35); padding:16px; border-radius:12px;
    }
    form#surfForm label{ display:flex; flex-direction:column; gap:6px; font-weight:600; }
    form#surfForm select, form#surfForm input{ padding:10px; border-radius:8px; border:none; }
    .span2{ grid-column:1/-1; }
    .mini{ font-size:.9rem; opacity:.9; }
    .result{ margin-top:20px; display:grid; gap:16px; }
    .result .grid{ display:grid; gap:16px; grid-template-columns: 1.2fr 1fr; }
    @media (max-width: 900px){ .result .grid{ grid-template-columns: 1fr; } }
    .card img{ height: 200px; }
    .table{ width:100%; border-collapse: collapse; overflow:hidden; border-radius:12px; background: rgba(0,0,0,0.25); }
    .table th, .table td{ padding:10px 12px; border-bottom: 1px solid rgba(255,255,255,0.1); }
    .table th{ text-align:left; color: var(--c-accent); }
    .badge{ display:inline-block; padding:2px 8px; border-radius:9999px; background: rgba(255,255,255,0.15); font-size:.85rem; }
    .row{ display:flex; gap:10px; align-items:center; flex-wrap:wrap; }

    /* ãƒ—ãƒ­ãƒã‚¤ãƒ€æ¤œç´¢ã‚«ãƒ¼ãƒ‰ */
    .providers{ display:grid; gap:12px; grid-template-columns: repeat(2, 1fr); }
    @media (max-width:720px){ .providers{ grid-template-columns: 1fr; } }
    .prov-card{ background: rgba(255,255,255,0.07); border-radius:12px; padding:12px; display:flex; flex-direction:column; gap:8px; }
    .prov-card h4{ margin:0; font-size:1rem; color: var(--c-accent); }
    .prov-links{ display:flex; gap:8px; flex-wrap:wrap; }
    .prov-links a{ text-decoration:none; border-radius:10px; padding:8px 10px; background: rgba(255,255,255,0.12); }
    .prov-links a:hover{ background: rgba(255,255,255,0.2); }

    /* å­¦ç¿’ãƒ¢ãƒ¼ãƒ‰ï¼ˆç°¡æ˜“ï¼‰ */
    .accordion{ margin-top:24px; }
    .acc-item{ background: rgba(0,0,0,0.35); border-radius:12px; margin-bottom:10px; overflow:hidden; }
    .acc-head{ width:100%; text-align:left; background: transparent; border:none; padding:14px 16px; color:#fff; display:flex; justify-content:space-between; align-items:center; cursor:pointer; }
    .acc-body{ display:none; padding:0 16px 16px; }
    .acc-item.open .acc-body{ display:block; }
    .chev{ transition: transform .2s ease; }
    .acc-item.open .chev{ transform: rotate(90deg); }
  </style>
</head>
<body>
  <!-- ãƒ˜ãƒƒãƒ€ãƒ¼ -->
  <header class="site-header">
    <a href="index.html" class="logo">ğŸŒŠ SEA LIFE HUB</a>
    <nav class="site-nav" aria-label="Primary">
      <a href="index.html">ãƒ›ãƒ¼ãƒ </a>
      <div class="dropdown">
        <button class="dropbtn" aria-haspopup="true" aria-expanded="false">ãƒ¡ãƒ‹ãƒ¥ãƒ¼ â–¾</button>
        <div class="dropdown-content" role="menu">
          <a href="diagnosis.html" class="is-active" role="menuitem">ã‚µãƒ¼ãƒ•ãƒœãƒ¼ãƒ‰è¨ºæ–­</a>
          <a href="apparel.html" role="menuitem">ã‚¢ãƒ‘ãƒ¬ãƒ«ï¼ˆTã‚·ãƒ£ãƒ„ï¼‰</a>
          <a href="stays.html" role="menuitem">æµ·æ²¿ã„æ°‘æ³Š</a>
        </div>
      </div>
      <a href="index.html#about">ã“ã®ã‚µã‚¤ãƒˆã«ã¤ã„ã¦</a>
    </nav>
    <button class="hamburger" aria-label="ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é–‹ã" aria-controls="mobileNav" aria-expanded="false"><span class="bar"></span></button>
  </header>
  <div class="header-spacer"></div>

  <!-- ãƒ¢ãƒã‚¤ãƒ«ãƒ¡ãƒ‹ãƒ¥ãƒ¼ -->
  <div class="mobile-nav-backdrop" id="backdrop"></div>
  <nav class="mobile-nav" id="mobileNav" aria-label="Mobile">
    <div class="mobile-title">ğŸŒŠ SEA LIFE HUB</div>
    <a href="index.html">ãƒ›ãƒ¼ãƒ </a>
    <a href="diagnosis.html" class="is-active">ã‚µãƒ¼ãƒ•ãƒœãƒ¼ãƒ‰è¨ºæ–­</a>
    <a href="apparel.html">ã‚¢ãƒ‘ãƒ¬ãƒ«ï¼ˆTã‚·ãƒ£ãƒ„ï¼‰</a>
    <a href="stays.html">æµ·æ²¿ã„æ°‘æ³Š</a>
    <a href="index.html#about">ã“ã®ã‚µã‚¤ãƒˆã«ã¤ã„ã¦</a>
  </nav>

  <!-- æœ¬æ–‡ -->
  <section class="overlay">
    <main class="container">
      <h1 class="section-title">ã‚µãƒ¼ãƒ•ãƒœãƒ¼ãƒ‰è¨ºæ–­ + æ›–æ˜§æ¤œç´¢ï¼ˆå¼·åº¦åˆ‡æ›¿ï¼‰</h1>

      <form id="surfForm">
        <label>ä½“é‡ï¼ˆkgï¼‰<input id="weight" type="number" min="35" max="120" step="1" placeholder="ä¾‹ï¼‰68" required /></label>
        <label>ãƒ¬ãƒ™ãƒ«
          <select id="level"><option value="beginner">åˆå¿ƒè€…</option><option value="intermediate" selected>ä¸­ç´š</option><option value="advanced">ä¸Šç´š</option></select>
        </label>
        <label>æ³¢ã‚µã‚¤ã‚º
          <select id="wave"><option value="small">å°æ³¢ï¼ˆè†ã€œè…¹ï¼‰</option><option value="mid" selected>ãƒŸãƒ‰ãƒ«ï¼ˆè…°ã€œèƒ¸ï¼‰</option><option value="solid">è‚©ã€œé ­ä»¥ä¸Š</option></select>
        </label>
        <label>ã‚¹ã‚¿ã‚¤ãƒ«
          <select id="style"><option value="easy">æœ¬æ•°é‡è¦–</option><option value="maneuver" selected>æŠ€ãƒ»æ©Ÿå‹•æ€§</option><option value="cruise">ã‚¯ãƒ«ãƒ¼ã‚º</option></select>
        </label>
        <label>ä½“åŠ›
          <select id="fitness"><option value="low">å¼±ã‚</option><option value="mid" selected>ãµã¤ã†</option><option value="high">å¼·ã‚</option></select>
        </label>
        <label>æµ®åŠ›ã®å¥½ã¿
          <select id="floatPref"><option value="more">ã‚„ã‚„å¤šã‚</option><option value="neutral" selected>ãµã¤ã†</option><option value="less">ã‚„ã‚„å°‘ãªã‚</option></select>
        </label>

        <label class="span2">æ¤œç´¢ã®å³ã—ã•
          <select id="strictness">
            <option value="strict">å³å¯†ï¼ˆæ¡ä»¶å¼·ã‚ãƒ»ãƒã‚¤ã‚ºå°‘ãªã‚ï¼‰</option>
            <option value="normal" selected>æ¨™æº–ï¼ˆãŠã™ã™ã‚ï¼‰</option>
            <option value="loose">ã‚†ã‚‹ã‚ï¼ˆãƒ’ãƒƒãƒˆé‡è¦–ï¼‰</option>
          </select>
        </label>

        <div class="span2 mini">
          â€»0ä»¶ã®ã¨ãã¯ã€Œã‚†ã‚‹ã‚ã€ãƒªãƒ³ã‚¯ã‚’ãŠè©¦ã—ãã ã•ã„ã€‚é•·ã•ãƒ»ä½“ç©ãƒ»é™¤å¤–èªã‚’æ®µéšçš„ã«å¼±ã‚ã¾ã™ã€‚
        </div>

        <button class="btn primary span2" type="button" onclick="diagnose()">è¨ºæ–­ã™ã‚‹</button>
      </form>

      <div id="result" class="result"></div>

      <section class="accordion">
        <h2 class="section-title">å­¦ç¿’ãƒ¢ãƒ¼ãƒ‰</h2>
        <div class="acc-item">
          <button class="acc-head"><strong>ãƒ†ãƒ¼ãƒ«å½¢çŠ¶ã®åŸºæœ¬</strong><span class="chev">â–¶</span></button>
          <div class="acc-body">
            <ul>
              <li><strong>ã‚¹ã‚¯ã‚¢ãƒƒã‚·ãƒ¥</strong>ï¼šæ±ç”¨æ€§ãŒé«˜ãåˆ‡ã‚Šè¿”ã—è»½å¿«ã€‚</li>
              <li><strong>ã‚¹ãƒ¯ãƒ­ãƒ¼</strong>ï¼šå°æ³¢ã§ã®ã‚°ãƒªãƒƒãƒ—ã¨ã‚¹ãƒ”ãƒ¼ãƒ‰ã€‚</li>
              <li><strong>ãƒ©ã‚¦ãƒ³ãƒ‰</strong>ï¼šã‚¿ãƒ¼ãƒ³ãŒã‚¹ãƒ ãƒ¼ã‚ºã€‚</li>
              <li><strong>ãƒ”ãƒ³</strong>ï¼šã‚µã‚¤ã‚ºã‚ã‚‹æ³¢ã§ã®ãƒ›ãƒ¼ãƒ«ãƒ‰é‡è¦–ã€‚</li>
            </ul>
          </div>
        </div>
      </section>
    </main>
  </section>

  <footer class="site-footer"><p>Â© <span id="year"></span> SEA LIFE HUB</p></footer>

  <script>
    document.getElementById('year').textContent = new Date().getFullYear();

    /* ===== è¨ºæ–­ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆå¾“æ¥é€šã‚Šï¼‰ ===== */
    function calcVolume(weight, level, fitness, floatPref){
      let base = (level==='beginner')?0.50:(level==='advanced')?0.40:0.45;
      if(fitness==='low') base += 0.03; if(fitness==='high') base -= 0.03;
      if(floatPref==='more') base += 0.02; if(floatPref==='less') base -= 0.02;
      base = Math.max(0.35, Math.min(0.60, base));
      const liters = Math.round(weight * base * 10)/10;
      const low = Math.round(liters * 0.9 * 10)/10;
      const high = Math.round(liters * 1.1 * 10)/10;
      return { liters, range:[low, high], factor: base };
    }

    function pickBoardType(level, wave, style){
      if(level==='beginner'){
        if(style==='maneuver' && wave!=='small') return {type:'ã‚ªãƒ¼ãƒ«ãƒ©ã‚¦ãƒ³ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆ', why:'ä¸Šé”ã‚’è¦‹æ®ãˆã¤ã¤å–ã‚Šå›ã—ã‚„ã™ã„'};
        if(style==='cruise') return {type:'ãƒ­ãƒ³ã‚°/ãƒŸãƒƒãƒ‰', why:'æ—©ã„ãƒ†ã‚¤ã‚¯ã‚ªãƒ•ã§ã‚¯ãƒ«ãƒ¼ã‚º'};
        return {type:'ã‚½ãƒ•ãƒˆãƒœãƒ¼ãƒ‰/ãƒ•ã‚¡ãƒ³', why:'å®‰å®šï¼†æœ¬æ•°ç¢ºä¿'};
      }
      if(level==='intermediate'){
        if(style==='maneuver') return (wave==='small')?{type:'ãƒ•ã‚£ãƒƒã‚·ãƒ¥/ãƒ„ã‚¤ãƒ³å¯„ã‚Šã‚·ãƒ§ãƒ¼ãƒˆ', why:'å°æ³¢ã§åŠ é€Ÿ'}:{type:'ã‚ªãƒ¼ãƒ«ãƒ©ã‚¦ãƒ³ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆ', why:'æŠ€ã¨èµ°ã‚Šã®ãƒãƒ©ãƒ³ã‚¹'};
        if(style==='cruise') return {type:'ãƒŸãƒƒãƒ‰/ãƒ­ãƒ³ã‚°', why:'æœ¬æ•°ã¨ãƒ©ã‚¤ãƒ³å–ã‚Š'};
        return {type:'ãƒŸãƒƒãƒ‰/ã‚·ãƒ§ãƒ¼ãƒˆ(ã‚„ã‚„ãƒœãƒªãƒ¥ãƒ¼ãƒ å¤šã‚)', why:'å–ã‚Šå›ã—ã¨å®‰å®šã®ä¸­åº¸'};
      }
      if(style==='cruise') return {type:'ãƒ­ãƒ³ã‚°', why:'å¤§ãã„ãƒ©ã‚¤ãƒ³ã§ã‚¯ãƒ«ãƒ¼ã‚º'};
      return (wave==='small')?{type:'ãƒã‚¤ãƒœãƒªãƒ¥ãƒ¼ãƒ ã‚·ãƒ§ãƒ¼ãƒˆ/ãƒ•ã‚£ãƒƒã‚·ãƒ¥', why:'å°æ³¢ã§ã‚‚æ¨é€²åŠ›'}:{type:'HPã‚·ãƒ§ãƒ¼ãƒˆ', why:'æ©Ÿå‹•æ€§ãƒ»æ€§èƒ½é‡è¦–'};
    }

    const sizeTable = {
      'ã‚½ãƒ•ãƒˆãƒœãƒ¼ãƒ‰/ãƒ•ã‚¡ãƒ³':   { len:[7.0, 8.0],   wid:[21.0, 23.0], thick:[2.75, 3.3] },
      'ãƒŸãƒƒãƒ‰ãƒ¬ãƒ³ã‚°ã‚¹':        { len:[6.8, 7.6],   wid:[20.5, 22.5], thick:[2.6, 3.0] },
      'ãƒ­ãƒ³ã‚°/ãƒŸãƒƒãƒ‰':         { len:[9.0, 9.6],   wid:[22.5, 23.5], thick:[2.75, 3.25] },
      'ãƒ•ã‚£ãƒƒã‚·ãƒ¥/ãƒ„ã‚¤ãƒ³å¯„ã‚Šã‚·ãƒ§ãƒ¼ãƒˆ': { len:[5.4, 6.0], wid:[19.5, 21.5], thick:[2.4, 2.7] },
      'ã‚ªãƒ¼ãƒ«ãƒ©ã‚¦ãƒ³ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆ': { len:[5.83, 6.33], wid:[18.5, 20.5], thick:[2.3, 2.6] },
      'ãƒŸãƒƒãƒ‰/ã‚·ãƒ§ãƒ¼ãƒˆ(ã‚„ã‚„ãƒœãƒªãƒ¥ãƒ¼ãƒ å¤šã‚)': { len:[6.0, 6.6], wid:[19.5, 21.5], thick:[2.5, 2.8] },
      'ãƒã‚¤ãƒœãƒªãƒ¥ãƒ¼ãƒ ã‚·ãƒ§ãƒ¼ãƒˆ/ãƒ•ã‚£ãƒƒã‚·ãƒ¥': { len:[5.8, 6.4], wid:[19.5, 21.5], thick:[2.5, 2.8] },
      'HPã‚·ãƒ§ãƒ¼ãƒˆ':            { len:[5.8, 6.2],  wid:[18.0, 19.5], thick:[2.25, 2.5] },
      'ãƒ­ãƒ³ã‚°':                { len:[9.0, 9.6],  wid:[22.5, 23.5], thick:[2.75, 3.25] }
    };

    function adjustByWeightAndWave(base, weight, wave){
      const bucket = (weight<55)? -1 : (weight<=75)? 0 : 1;
      const waveAdj = (wave==='small')? +0.0 : (wave==='mid')? +0.05 : +0.1;
      const lerpRange = ([min,max], k)=>[ +(min+(max-min)*k).toFixed(2), +(max+(max-min)*k).toFixed(2) ];
      const k = (bucket===-1)? -0.05 : (bucket===1)? 0.05 : 0;
      let len=lerpRange(base.len, k + waveAdj*0.3);
      let wid=lerpRange(base.wid, k*0.8 + waveAdj*0.2);
      let thk=lerpRange(base.thick, k + waveAdj*0.4);
      return {len,wid,thk};
    }

    /* ===== æ›–æ˜§æ¤œç´¢ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ ===== */
    const toFeetInches = (val)=>{ const f=Math.floor(val); const i=Math.round((val-f)*12); return {feet:f, inches:i}; };
    const fmtFeetInches = ({feet,inches}) => `${feet}'${inches}"`;
    const rangeFeetInches = ([a,b])=>{ const A=toFeetInches(a), B=toFeetInches(b); return `${fmtFeetInches(A)} ã€œ ${fmtFeetInches(B)}`; };
    const rangeCm = ([a,b])=>`${Math.round(a*30.48)}ã€œ${Math.round(b*30.48)}cm`;
    const rangeInch = ([a,b])=>`${a.toFixed(2)}ã€œ${b.toFixed(2)}"`;

    // ä¸­å¤®é•·ã‚’æŠ½å‡º â†’ é•·ã•ã®è¡¨è¨˜æºã‚Œãƒãƒªã‚¨ãƒ¼ã‚·ãƒ§ãƒ³
    function lengthPatterns(lenRange, mode){
      const mid = (lenRange[0] + lenRange[1]) / 2;
      const {feet,inches} = toFeetInches(mid);
      const prime = `${feet}'${inches}"`;    // 5'10"
      const dot   = `${feet}.${String(inches).padStart(2,'0')}`; // 5.10
      const dash  = `${feet}-${inches}`;     // 5-10
      const ft    = `${feet}ft${inches}`;    // 5ft10
      if(mode==='strict') return [prime, dot, dash, ft];
      if(mode==='normal') return [prime, dot, dash]; // å°‘ã—ç·©ã‚ã‚‹
      return []; // ã‚†ã‚‹ã‚ï¼šé•·ã•ã‚’ä½¿ã‚ãªã„ï¼ˆãƒ’ãƒƒãƒˆé‡è¦–ï¼‰
    }

    // ä½“ç©ãƒ¬ãƒ³ã‚¸ï¼ˆå³å¯†Â±10%ã€æ¨™æº–Â±18%ã€ã‚†ã‚‹ã‚ï¼šç„¡ã—ï¼‰
    function literTokens(liters, mode){
      if(mode==='strict') return [`${liters}L`, `${Math.round(liters-1)}L`, `${Math.round(liters+1)}L`];
      if(mode==='normal') {
        const lo = Math.round(liters*0.82), hi = Math.round(liters*1.18);
        return [`${liters}L`, `${lo}L`, `${hi}L`];
      }
      return []; // ã‚†ã‚‹ã‚ã¯ä½“ç©ã§ç¸›ã‚‰ãªã„
    }

    // é™¤å¤–èªï¼ˆã‚¢ã‚¯ã‚»ã‚µãƒªç­‰ï¼‰ï¼šå³å¯†ã®ã¿å¼·ã€æ¨™æº–ã¯è»½ã€ã‚†ã‚‹ã‚ã¯ç„¡ã—
    function exclusions(mode){
      if(mode==='strict') return ' -"ãƒ•ã‚£ãƒ³" -"FCS" -"ãƒªãƒ¼ã‚·ãƒ¥" -"ã‚±ãƒ¼ã‚¹" -"ãƒœãƒ¼ãƒ‰ã‚±ãƒ¼ã‚¹" -"ãƒ‡ãƒƒã‚­ãƒ‘ãƒƒãƒ‰" -"ãƒ¯ãƒƒã‚¯ã‚¹" -"ãƒã‚¸" -"ã‚¹ã‚¯ãƒªãƒ¥ãƒ¼"';
      if(mode==='normal') return ' -"ãƒªãƒ¼ã‚·ãƒ¥" -"ã‚±ãƒ¼ã‚¹"';
      return ''; // ã‚†ã‚‹ã‚ï¼šé™¤å¤–ã—ãªã„
    }

    // ç¨®åˆ¥ã®è¡¨è¨˜ã‚†ã‚Œã‚’å¸å
    function normalizeTypeForQuery(type){
      return type
        .replace('ãƒŸãƒƒãƒ‰/ã‚·ãƒ§ãƒ¼ãƒˆ(ã‚„ã‚„ãƒœãƒªãƒ¥ãƒ¼ãƒ å¤šã‚)','ã‚·ãƒ§ãƒ¼ãƒˆ')
        .replace('ãƒã‚¤ãƒœãƒªãƒ¥ãƒ¼ãƒ ã‚·ãƒ§ãƒ¼ãƒˆ/ãƒ•ã‚£ãƒƒã‚·ãƒ¥','ã‚·ãƒ§ãƒ¼ãƒˆ ãƒ•ã‚£ãƒƒã‚·ãƒ¥')
        .replace('ãƒ•ã‚£ãƒƒã‚·ãƒ¥/ãƒ„ã‚¤ãƒ³å¯„ã‚Šã‚·ãƒ§ãƒ¼ãƒˆ','ã‚·ãƒ§ãƒ¼ãƒˆ ãƒ•ã‚£ãƒƒã‚·ãƒ¥ ãƒ„ã‚¤ãƒ³')
        .replace('ãƒ­ãƒ³ã‚°/ãƒŸãƒƒãƒ‰','ãƒ­ãƒ³ã‚° ãƒŸãƒƒãƒ‰')
        .replace('ã‚ªãƒ¼ãƒ«ãƒ©ã‚¦ãƒ³ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆ','ã‚·ãƒ§ãƒ¼ãƒˆ ã‚ªãƒ¼ãƒ«ãƒ©ã‚¦ãƒ³ãƒ‰');
    }

    // ã‚¯ã‚¨ãƒªãƒ“ãƒ«ãƒ‰ï¼ˆmode: strict / normal / looseï¼‰
    function buildQuery(type, lenRange, liters, mode){
      const head = 'ã‚µãƒ¼ãƒ•ãƒœãƒ¼ãƒ‰'; // ã‚µãƒ¼ãƒ•ãƒœãƒ¼ãƒ‰é™å®š
      const t = normalizeTypeForQuery(type);
      const lens = lengthPatterns(lenRange, mode);
      const Ls = literTokens(liters, mode);
      const excl = exclusions(mode);

      // çµ„ã¿åˆã‚ã›ã®å„ªå…ˆï¼šå³å¯†=ã‚¿ã‚¤ãƒ—+é•·ã•+Lã€æ¨™æº–=ã‚¿ã‚¤ãƒ—+ï¼ˆé•·ã• or Lï¼‰ã€ã‚†ã‚‹ã‚=ã‚¿ã‚¤ãƒ—ã®ã¿
      if(mode==='strict'){
        return [
          `${head} ${t} ${lens[0]} ${Ls[0]}${excl}`,
          `${head} ${t} ${lens[1]} ${Ls[0]}${excl}`,
          `${head} ${t} ${lens[0]} ${Ls[1]}${excl}`,
        ].filter(Boolean);
      }
      if(mode==='normal'){
        const qs = [];
        if(lens.length) qs.push(`${head} ${t} ${lens[0]} ${Ls[0]||''} ${excl}`.trim());
        if(Ls.length)   qs.push(`${head} ${t} ${Ls[0]} ${excl}`.trim());
        qs.push(`${head} ${t} ${excl}`.trim()); // ä¿é™ºï¼šã‚¿ã‚¤ãƒ—ã®ã¿
        return qs;
      }
      // loose
      return [
        `${head} ${t}`.trim(),
        `${head} ${t} ä¸­å¤`.trim(), // ä¸­å¤ã‚‚ä¸€å¿œ
      ];
    }

    // å„ã‚µã‚¤ãƒˆç”¨ãƒªãƒ³ã‚¯ã‚’ç”Ÿæˆï¼ˆmodeåˆ¥ï¼‰
    function providerLinksForMode(mode, type, lenRange, liters){
      const enc = encodeURIComponent;
      const qs = buildQuery(type, lenRange, liters, mode);

      // å„ã‚µã‚¤ãƒˆã¯ã‚¯ã‚¨ãƒªé…åˆ—ã®å…ˆé ­ã‚’ä½¿ã„ã€ä»£æ›¿ã‚‚1ã¤æŒã¤ï¼ˆ0ä»¶å¯¾ç­–ï¼‰
      const qMain = qs[0] || '';
      const qAlt = qs[1] || qs[0] || '';

      return [
        {
          name:'Amazon',
          urls:[
            { label: 'æ¤œç´¢', url:`https://www.amazon.co.jp/s?k=${enc(qMain)}` },
            { label: 'ä»£æ›¿', url:`https://www.amazon.co.jp/s?k=${enc(qAlt)}` },
          ]
        },
        {
          name:'æ¥½å¤©',
          urls:[
            { label: 'æ¤œç´¢', url:`https://search.rakuten.co.jp/search/mall/${enc(qMain)}/?st=t&f=0` },
            { label: 'ä»£æ›¿', url:`https://search.rakuten.co.jp/search/mall/${enc(qAlt)}/?st=t&f=0` },
          ]
        },
        {
          name:'ãƒ¡ãƒ«ã‚«ãƒªï¼ˆä¸­å¤ï¼‰',
          urls:[
            { label: 'æ¤œç´¢', url:`https://www.mercari.com/jp/search/?keyword=${enc(qMain)}` },
            { label: 'ä»£æ›¿', url:`https://www.mercari.com/jp/search/?keyword=${enc(qAlt)}` },
          ]
        },
        {
          name:'ãƒ¤ãƒ•ã‚ªã‚¯ï¼ˆä¸­å¤ï¼‰',
          urls:[
            { label: 'æ¤œç´¢', url:`https://auctions.yahoo.co.jp/search/search?p=${enc(qMain)}&n=50&exflg=1` },
            { label: 'ä»£æ›¿', url:`https://auctions.yahoo.co.jp/search/search?p=${enc(qAlt)}&n=50&exflg=1` },
          ]
        },
        {
          name:'Googleï¼ˆåºƒåŸŸï¼‰',
          urls:[
            { label: 'æ¤œç´¢', url:`https://www.google.com/search?q=${enc(qMain)}` },
            { label: 'ä»£æ›¿', url:`https://www.google.com/search?q=${enc(qAlt)}` },
          ]
        }
      ];
    }

    function buildAllProviders(type, lenRange, liters){
      const modes = ['strict', 'normal', 'loose'];
      const modeLabel = { strict: 'å³å¯†', normal: 'æ¨™æº–', loose: 'ã‚†ã‚‹ã‚' };
      return modes.map(mode => {
        const links = providerLinksForMode(mode, type, lenRange, liters);
        return { mode, label: modeLabel[mode], links };
      });
    }

    /* ===== ãƒ¡ã‚¤ãƒ³ï¼šè¨ºæ–­ â†’ ãƒªãƒ³ã‚¯ç”Ÿæˆ ===== */
    function diagnose(){
      const weight = Number(document.getElementById('weight').value || 0);
      const level = document.getElementById('level').value;
      const wave = document.getElementById('wave').value;
      const style = document.getElementById('style').value;
      const fitness = document.getElementById('fitness').value;
      const floatPref = document.getElementById('floatPref').value;
      const strictness = document.getElementById('strictness').value;

      if(!weight || weight < 35){ alert('ä½“é‡(kg)ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„'); return; }

      const vol = calcVolume(weight, level, fitness, floatPref);
      const board = pickBoardType(level, wave, style);
      const base = sizeTable[board.type] || sizeTable['ãƒŸãƒƒãƒ‰ãƒ¬ãƒ³ã‚°ã‚¹'];
      const sized = adjustByWeightAndWave(base, weight, wave);

      const img = (board.type.includes('ãƒ­ãƒ³ã‚°')) ? 'images/stays.jpg'
                : (board.type.includes('ãƒŸãƒƒãƒ‰')) ? 'images/diagnosis.jpg'
                : 'images/apparel.jpg';

      // 3æ®µéšï¼ˆå³å¯†/æ¨™æº–/ã‚†ã‚‹ã‚ï¼‰ã®ãƒªãƒ³ã‚¯ã‚»ãƒƒãƒˆã‚’ã¾ã¨ã‚ã¦ç”¨æ„
      const bundles = buildAllProviders(board.type, sized.len, vol.liters);

      // æœ€åˆã«é¸æŠä¸­ã®å³ã—ã•ã‚’ä¸Šã«è¡¨ç¤º
      const sorted = bundles.sort(b => (b.mode===strictness? -1 : 0));

      const providersHtml = sorted.map(b => `
        <div class="prov-card">
          <h4>${b.label} æ¤œç´¢</h4>
          <div class="prov-links">
            ${b.links.map(p => p.urls.map(u => `<a class="btn link" target="_blank" href="${u.url}">${p.name}ãƒ»${u.label}</a>`).join('')).join('')}
          </div>
        </div>
      `).join('');

      const html = `
        <div class="grid">
          <article class="card">
            <img src="${img}" alt="${board.type}">
            <div class="card-body">
              <h3>${board.type}</h3>
              <p>${board.why}</p>
              <p class="mini">0ä»¶ã®ã¨ãã¯<strong>ã€Œæ¨™æº–ã€â†’ã€Œã‚†ã‚‹ã‚ã€</strong>ã®é †ã§ãƒªãƒ³ã‚¯ã‚’ãŠè©¦ã—ãã ã•ã„ã€‚</p>
            </div>
          </article>

          <div>
            <table class="table">
              <thead><tr><th>é …ç›®</th><th>æ¨å¥¨å€¤ï¼ˆç›®å®‰ï¼‰</th></tr></thead>
              <tbody>
                <tr><td>ä½“é‡</td><td>${weight} kg</td></tr>
                <tr><td>æ¨å¥¨ãƒœãƒªãƒ¥ãƒ¼ãƒ </td><td><strong>${vol.liters}â„“</strong>ï¼ˆç´„${vol.range[0]}ã€œ${vol.range[1]}â„“ï¼‰ <span class="mini">ä¿‚æ•°:${vol.factor.toFixed(2)}</span></td></tr>
                <tr><td>é•·ã•</td><td>${rangeFeetInches(sized.len)} <span class="mini">ï¼ˆ${rangeCm(sized.len)}ï¼‰</span></td></tr>
                <tr><td>å¹…</td><td>${rangeInch(sized.wid)}</td></tr>
                <tr><td>åšã¿</td><td>${rangeInch(sized.thk)}</td></tr>
              </tbody>
            </table>

            <h3 style="margin:12px 0 8px;">å€™è£œã‚’æ¢ã™ï¼ˆæ›–æ˜§æ¤œç´¢ãƒªãƒ³ã‚¯ï¼‰</h3>
            <div class="mini" style="margin-bottom:8px;">â€»å³å¯†â†’æ¨™æº–â†’ã‚†ã‚‹ã‚ã®é †ã§ã€é•·ã•/ä½“ç©/é™¤å¤–èªã®æ‹˜æŸã‚’å¼±ã‚ãŸãƒªãƒ³ã‚¯ã‚’ä¸¦ã¹ã¦ã„ã¾ã™ã€‚</div>
            <div class="providers">
              ${providersHtml}
            </div>
          </div>
        </div>
      `;

      document.getElementById('result').innerHTML = html;
      window.scrollTo({ top: document.getElementById('result').offsetTop - 20, behavior: 'smooth' });
    }

    // ã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³
    document.addEventListener('click', (e)=>{
      const head = e.target.closest('.acc-head'); if(!head) return;
      head.parentElement.classList.toggle('open');
    });

    // ãƒ¢ãƒã‚¤ãƒ«ãƒ¡ãƒ‹ãƒ¥ãƒ¼ï¼ˆå‰å®Ÿè£…ã¨åŒç­‰ï¼‰
    (function(){
      const body=document.body, burger=document.querySelector('.hamburger');
      const mobileNav=document.getElementById('mobileNav'), backdrop=document.getElementById('backdrop');
      const deskDropdown=document.querySelector('.dropdown'), deskBtn=deskDropdown?.querySelector('.dropbtn');
      const closeMobile=()=>{ body.classList.remove('nav-open'); burger?.setAttribute('aria-expanded','false'); };
      burger?.addEventListener('click', (e)=>{ e.stopPropagation(); const willOpen=!body.classList.contains('nav-open'); document.querySelectorAll('.dropdown.open').forEach(d=>d.classList.remove('open')); if(willOpen){ body.classList.add('nav-open'); burger.setAttribute('aria-expanded','true'); } else { closeMobile(); }});
      backdrop?.addEventListener('click', closeMobile);
      mobileNav?.addEventListener('click', (e)=>{ if(e.target.tagName==='A') closeMobile(); });
      document.addEventListener('keydown', (e)=>{ if(e.key==='Escape') closeMobile(); });
      if(deskDropdown && deskBtn){
        const closeAll=()=>deskDropdown.classList.remove('open');
        deskBtn.addEventListener('click', (e)=>{ e.stopPropagation(); const willOpen=!deskDropdown.classList.contains('open'); document.querySelectorAll('.dropdown.open').forEach(d=>d.classList.remove('open')); if(willOpen) deskDropdown.classList.add('open'); else closeAll(); });
        document.addEventListener('click', (e)=>{ if(!deskDropdown.contains(e.target)) deskDropdown.classList.remove('open'); });
        document.addEventListener('keydown', (e)=>{ if(e.key==='Escape') deskDropdown.classList.remove('open'); });
      }
    })();
  </script>
</body>
</html>
